<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Beating Heart Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="model.js"></script>
  <script type="module" src="global.js"></script>
</head>

<body>
  <div class="nav">
    <h1>WeLoveSpeed</h1>
  </div>
  <button id="themeButton">Toggle Theme</button>
  <div class="container">
    <div class="left">
      <h2>Heart Rate Measure</h2>
      <p class="description">
        Your goals matter. Provide your profile and goal and we will calculate
        the appropriate speed and heart rate at which you should exercise.
      </p>
      <div class="input-container">
        <div class="text-input">
          <span>Height</span>
          <input type="number" id="heightInput" min="100" max="240" value="180" />
        </div>
        <div class="text-input">
          <span>Weight</span>
          <input type="number" id="weightInput" min="100" max="240" value="150" />
        </div>
        
        <div class="text-input">
          <span>Age</span>
          <input type="number" id="ageInput" min="20" max="65" value="20" />
        </div>
        <div class="text-input">
          <span>Sex</span>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="sex" value="male" checked /> Male
            </label>
            <label class="radio-option">
              <input type="radio" name="sex" value="female" /> Female
            </label>
          </div>
        </div>
        <div class="text-input">
          <span>Goals</span>
          <div class="goals">
            <label class="radio-option">
              <input type="radio" name="goal" value="5" checked/> Boost sprinting speed
            </label>
            <label class="radio-option">
              <input type="radio" name="goal" value="4" /> Increase anaerobic threshold
            </label>
            <label class="radio-option">
              <input type="radio" name="goal" value="3" /> Improve aerobic fitness
            </label>
            <label class="radio-option">
              <input type="radio" name="goal" value="2" /> Increase endurance
            </label>
            <label class="radio-option">
              <input type="radio" name="goal" value="1" /> Improve overall fitness
            </label>
          </div>
        </div>
        <button id="filter">Calculate Speed and Heart Rate</button>
      </div>
    </div>

    <div class="right">
      <svg id="track-svg" width="600" height="500"></svg>
    </div>
  </div>

  <script type="module">
    import { setupThemeToggle, setupPrediction, initTrackAnimation } from './global.js';
    setupThemeToggle();
    setupPrediction(); // if dataset defined in global.js
  </script>


  <!-- <script>
    // speed can be dynamically set from model.js later
    let speed = 5;
    const svg = d3.select("#track-svg");
    const width = +svg.attr("width");
    const height = +svg.attr("height");

    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const trackColor = '#c93e3e'; // Hardcoded darker red
    const dotColor = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--dot-dark' : '--dot-light');
    const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-light');

    const trackWidth = width * 0.6;
    const trackHeight = height * 0.6;
    const centerX = width / 2;
    const centerY = height / 2;

    const trackPath = svg.append("path")
      .attr("fill", "none")
      .attr("stroke", trackColor)
      .attr("stroke-width", 20)
      .attr("d", `
        M ${centerX - trackWidth / 2},${centerY - trackHeight / 2}
        A ${trackWidth / 2},${trackHeight / 2} 0 0 1 ${centerX + trackWidth / 2},${centerY - trackHeight / 2}
        L ${centerX + trackWidth / 2},${centerY + trackHeight / 2}
        A ${trackWidth / 2},${trackHeight / 2} 0 0 1 ${centerX - trackWidth / 2},${centerY + trackHeight / 2}
        Z
      `);

    const dot = svg.append("circle")
      .attr("r", 10)
      .attr("fill", dotColor);

    const pathNode = trackPath.node();
    const pathLength = pathNode.getTotalLength();

    function animateDot() {
      dot.transition()
        .duration(400 / 1609 / speed * 360000)
        .ease(d3.easeLinear)
        .attrTween("transform", () => t => {
          const point = pathNode.getPointAtLength(t * pathLength);
          return `translate(${point.x},${point.y})`;
        })
        .on("end", animateDot);
    }

    animateDot();

    const centerText = svg.append("text")
      .attr("x", centerX)
      .attr("y", centerY - 18)
      .attr("text-anchor", "middle")
      .attr("font-size", "32px")
      .attr("fill", textColor);

    centerText.append("tspan")
      .attr("x", centerX)
      .attr("dy", "1em")
      .text(`${Math.floor(400 / 1609 / speed * 3600 / 60)} min ${parseInt(400 / 1609 / speed * 3600) % 60} sec`)
      .attr("font-size", "50px");

    centerText.append("tspan")
      .attr("x", centerX)
      .attr("dy", "1.2em")
      .text("400m Olympic Track")
      .attr("font-size", "25px");
  </script> -->
</body>

</html>
